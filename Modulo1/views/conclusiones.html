<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conclusiones</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/sidebar.css">
    <link rel="stylesheet" href="../assets/css/ProgressBar.css">
    <link rel="stylesheet" href="../assets/css/conclusiones.css">

    <link rel="stylesheet" href="../assets/css/reproductor-iframe.css">

    <link rel="icon" href="../assets/images/ico.png" type="image/png">
    
    <script type="text/javascript" src="../js/sidebar.js" defer></script>
</head>

<body>
    <style>
    @media (max-width: 420px) {
      .start-button{
        padding: 18px 15px;
      }
    }
    </style>
    <button class="back-page-btn" onclick="backPage()">
        <span class="arrow">❮</span>
    </button>
    <nav id="sidebar" class="close">
        <div id="logo-seccion">
            <a href="../index.html">
                <img src="../assets/images/logo_blanco.png" height="10px" alt="logo">
            </a>
            <!-- <button id="toggle-btn">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#000">
                    <path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z" />
                </svg>
            </button> -->
        </div>

        <div id="barra">
            <span id="barra-titulo"><strong>Progreso del Curso</strong></span>
            <div id="progreso-container">
                <div id="progreso-barra"></div>
                <span id="progreso-texto">0%</span>
            </div>
        </div>

        <div id="menu-container"></div>

    </nav>

    <iframe src="./componentes/xaudio.html" class="audio-iframe" data-audio="../assets/audio/conclusiones.wav" title="Reproductor de audio"></iframe>

    <div class="inicio-container">
        <img src="../assets/images/logo_blanco.png" alt="Logo AngloAmerican" class="logo-inicio">
        <div class="inicio-box">
            <span class="inicio-module-number">05</span>
            <h1 class="inicio-title">Conclusiones</h1>
        </div>

        <div class="scroll-indicator">
            <span class="scroll-arrow">↓</span>
            <span class="scroll-text">Desliza para ver más</span>
        </div>
    </div>

    <div class="content-section" id="contentSection">
        <div class="content-header">
            <h3 class="gradient-text">¿Qué aprendimos?</h3>
        </div>

        <div class="learning-points">
            <div class="learning-item">
                <div class="learning-header">
                    <div class="learning-number">1</div>
                    <h3>Integración de Controles</h3>
                </div>
                <div class="learning-content">
                    <p>
                        La operación eficiente del circuito de molienda–clasificación depende de la integración entre controles automáticos, supervisión remota y maniobras locales, lo que asegura estabilidad del proceso y continuidad operativa.
                    </p>
                </div>
            </div>

            <div class="learning-item">
                <div class="learning-header">
                    <div class="learning-number">2</div>
                    <h3>Monitoreo de Variables Críticas</h3>
                </div>
                <div class="learning-content">
                    <p>
                        El monitoreo constante de variables críticas (flujo másico, nivel de pulpa, presión y temperatura) permite prevenir fallas, optimizar el rendimiento de los molinos SAG y de bolas, y mantener la calidad metalúrgica del producto.
                    </p>
                </div>
            </div>

            <div class="learning-item">
                <div class="learning-header">
                    <div class="learning-number">3</div>
                    <h3>Estrategias de Operación y Seguridad</h3>
                </div>
                <div class="learning-content">
                    <p>
                        La combinación de estrategias de operación normal, modos remoto/automático y acciones locales fortalece la seguridad, la confiabilidad de los equipos y la capacidad de respuesta frente a contingencias.
                    </p>
                </div>
            </div>
        </div>
        
        <button id="regresarBtn" class="start-button" onclick="window.location.href='../index.html'" disabled>
            Regresar al Inicio
            <span class="arrow">❯</span>
        </button>

        <style>
                        /* Estilos para el botón cuando está deshabilitado */
            button.start-button:disabled {
            background-color: #cccccc; /* Fondo gris para indicar inactividad */
            color: #666666;          /* Texto más opaco */
            cursor: not-allowed;      /* Cursor que indica que no es clickeable */
            opacity: 0.7;             /* Un poco de transparencia para un efecto "apagado" */
            box-shadow: none;         /* Quita cualquier sombra que pueda tener */
            }

            /* Opcional: se asegura de que no cambie de color al pasar el mouse por encima */
            button.start-button:disabled:hover {
                background-color: #cccccc;
                color: #666666;
            }
        </style>
    </div>
    <script src="../js/M4_inicio.js"></script>
    <script src="../js/SCORM.js"></script>
    <script>
        function backPage() {
            window.location.href = './M5/M5_pg2.html';
        }


        // Iniciar SCORM
        ScormManager.init();

        // Guardar progreso de esta página
        ScormManager.guardarProgreso("conclusiones.html"); // Cambia según la página

        // Recuperar progreso
        const datos = ScormManager.cargarProgreso();
        // if (datos) {
        //     console.log("Última página:", datos.ultimaPagina);
        //     console.log("Progreso:", datos.score + "%");
        // }
        document.addEventListener("DOMContentLoaded", () => {
            const progreso = ScormManager.cargarProgreso();
            const porcentaje = progreso.score ? parseInt(progreso.score) : 0;

            const barra = document.getElementById("progreso-barra");
            const texto = document.getElementById("progreso-texto");

            barra.style.width = porcentaje + "%";
            texto.textContent = porcentaje + "%";
        });


    </script>
    <script>
        // --- CÓDIGO ACTUALIZADO ---

        // 1. Seleccionar el botón por su ID
        const regresarButton = document.getElementById('regresarBtn');

        // 2. Función para verificar el estado al cargar la página
        document.addEventListener('DOMContentLoaded', (event) => {
            // Revisa si en el localStorage ya existe la marca 'audioTerminado'
            if (localStorage.getItem('audioTerminado') === 'true') {
                console.log('El audio ya había terminado. Botón desbloqueado desde el inicio.');
                // Si existe, desbloquea el botón inmediatamente
                regresarButton.disabled = false;
            }
        });

        // 3. Escuchar mensajes del iframe
        window.addEventListener('message', function(event) {
            // Opcional: Verificación de seguridad del origen
            // if (event.origin !== 'URL_DE_TU_IFRAME') return;

            // 4. Comprobar si el mensaje es el correcto
            if (event.data === 'audio-terminado') {
                console.log('Mensaje "audio-terminado" recibido. Desbloqueando y guardando estado.');
                
                // 5. Desbloquear el botón
                regresarButton.disabled = false;
                
                // 6. Guardar el estado en localStorage para futuras recargas
                localStorage.setItem('audioTerminado', 'true');
            }
        });
    </script>
</body>

</html>